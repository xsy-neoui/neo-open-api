import t from"axios";const e=async e=>{try{const s={...e,method:e?.method||"GET",data:e?.data||{},headers:{"Content-Type":"application/json",...e?.headers},timeout:e?.timeout||3e4};"GET"===s?.method&&(s.params=e?.data||{});const a=await t(s);return a?.data||{}}catch(t){throw t.response?console.error("接口请求报错 / 接口服务异常：",t.message):t.request?console.error("接口请求报错 / 接口未正常响应：",t.message):console.error("接口请求报错:",t,"，请求参数:",e),t}},s={query:async t=>{const s=t||{},a=s.xObjectApiKey||"",o=s.fields||[],c=s.page||1,d=s.pageSize||10;o.includes("id")||o.push("id");const r=(c-1)*d;let m=`select ${o.join(",")} from ${a}`;s.orderBy&&(m+=` order by ${s.orderBy}`),(s.page||s.pageSize)&&(m+=` limit ${d} offset ${r}`);try{const t={url:"/rest/data/v2/query",method:"GET",data:{q:m}},s=await e(t);if(200===s.code){const{records:t,totalSize:e}=s.result||{};return{status:!0,code:s.code,msg:s.msg||"获取业务对象数据列表成功",totalSize:e,data:t||[]}}return{status:!1,code:s.code,msg:s.msg||"获取业务对象数据列表失败",data:[]}}catch(t){return console.error("获取业务对象数据列表失败:",t),{status:!1,msg:t.msg||t.message||"获取业务对象数据列表失败",data:[]}}},getEntityTypeList:async(t,s)=>{const a=s||{},o=`/rest/data/v2.0/xobjects/${t}/busiType`;try{const t={...a,url:o,method:"GET"},s=await e(t);if(200===s.code||"200"===s.code){const{records:t,totalSize:e}=s.data||{};return{status:!0,code:s.code,msg:s.msg||"获取业务类型列表成功",totalSize:e,data:t||[]}}return{status:!1,code:s.code,msg:s.msg||"获取业务类型列表失败",data:[]}}catch(t){return console.error("获取业务类型列表失败:",t),{status:!1,msg:t.msg||t.message||"获取业务类型列表失败",data:[]}}},getEntityList:async t=>{const s=t||{},a=`/rest/metadata/v2.0/xobjects/filter?custom=${s.custom||!1}&active=${s.active||!0}`;try{const t={...s,url:a,method:"GET"},o=await e(t);if("0"===o.code||0===o.code||"200"===o.code||200===o.code){const{records:t,totalSize:e}=o.data||{};return{status:!0,code:o.code,msg:o.msg||"获取对象列表成功",totalSize:e,data:t||[]}}return{status:!1,code:o.code,msg:o.msg||"获取对象列表失败",data:[]}}catch(t){return console.error("获取对象列表失败:",t),{status:!1,msg:t.msg||t.message||"获取对象列表失败",data:[]}}},getDesc:async(t,s)=>{const a=s||{},o=`/rest/data/v2.0/xobjects/${t}/description`;try{const t={...s,url:o,method:a.method||"GET"},c=await e(t);return"200"===c.code||200===c.code?{status:!0,code:c.code,msg:c.msg||"获取业务对象描述数据成功",data:c.data||{}}:{status:!1,code:c.code,msg:c.msg||"获取业务对象描述数据失败",data:{}}}catch(t){return console.error("获取业务对象描述数据失败:",t),{status:!1,msg:t.msg||t.message||"获取业务对象描述数据失败",data:{}}}},create:async(t,s)=>{const a=s||{},o=`/rest/data/v2.0/xobjects/${t}`,c=a.data||{};try{const t={...s,url:o,method:a.method||"POST",data:{data:c}},d=await e(t);return"200"===d.code||200===d.code?{status:!0,code:d.code,msg:d.msg||"创建业务数据成功",data:d.data||{}}:{status:!1,code:d.code,msg:d.msg||"创建业务数据失败",data:{}}}catch(t){return console.error("创建业务数据失败:",t),{status:!1,msg:t.msg||t.message||"创建业务数据失败",data:{}}}},update:async(t,s,a)=>{const o=a||{},c=`/rest/data/v2.0/xobjects/${t}/${s}`,d=o.data||{};try{const t={...o,url:c,method:o.method||"PATCH",data:{data:d}},s=await e(t);return"200"===s.code||200===s.code?{status:!0,code:s.code,msg:s.msg||"更新业务数据成功",data:s.data||{}}:{status:!1,code:s.code,msg:s.msg||"更新业务数据失败",data:{}}}catch(t){return console.error("更新业务数据失败:",t),{status:!1,msg:t.msg||t.message||"更新业务数据失败",data:{}}}},get:async(t,s,a)=>{const o=a||{},c=`/rest/data/v2.0/xobjects/${t}/${s}`;try{const t={...o,url:c,method:o.method||"GET"},s=await e(t);return"200"===s.code||200===s.code?{status:!0,code:s.code,msg:s.msg||"获取业务数据成功",data:s.data||{}}:{status:!1,code:s.code,msg:s.msg||"获取业务数据失败",data:{}}}catch(t){return console.error("获取业务数据失败:",t),{status:!1,msg:t.msg||t.message||"获取业务数据失败",data:{}}}},delete:async(t,s,a)=>{const o=a||{},c=`/rest/data/v2.0/xobjects/${t}/${s}`;try{const t={...o,url:c,method:o.method||"DELETE"},s=await e(t);return"200"===s.code||200===s.code?{status:!0,code:s.code,msg:s.msg||"删除业务数据成功"}:{status:!1,code:s.code,msg:s.msg||"删除业务数据失败"}}catch(t){return console.error("删除业务数据失败:",t),{status:!1,msg:t.msg||t.message||"删除业务数据失败"}}}};export{e as axiosFetcher,s as xObject};
