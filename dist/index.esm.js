import t from"axios";const e=async e=>{try{const s={...e,method:e?.method||"GET",data:e?.data||{},headers:{"xsy-inner-source":"neo-open-api","Content-Type":"application/json",...e?.headers},timeout:e?.timeout||3e4};"GET"===s?.method&&(s.params=e?.data||{});const a=await t(s);return a?.data||{}}catch(t){throw t.response?console.error("接口请求报错 / 接口服务异常：",t.message):t.request?console.error("接口请求报错 / 接口未正常响应：",t.message):console.error("接口请求报错:",t,"，请求参数:",e),t}},s={query:async t=>{const s=t||{},a=s.xObjectApiKey||"",o=Object.assign([],s.fields||[]),c=s.page||1,r=s.pageSize||10;o.includes("id")||o.push("id");const d=(c-1)*r;let m=`select ${o.join(",")} from ${a}`;s.orderBy&&(m+=` order by ${s.orderBy}`),(s.page||s.pageSize)&&(m+=` limit ${d},${r}`);try{const t={url:"/rest/data/v2/query",method:"GET",data:{q:m}},s=await e(t);if(200===s.code){const{records:t,totalSize:e}=s.result||{};return{status:!0,code:s.code,msg:s.msg||"获取业务对象数据列表成功",totalSize:e,data:t||[]}}return{status:!1,code:s.code,msg:s.msg||"获取业务对象数据列表失败",data:[]}}catch(t){return console.error("获取业务对象数据列表失败:",t),{status:!1,msg:t.msg||t.message||"获取业务对象数据列表失败",data:[]}}},getEntityTypeList:async(t,s)=>{const a=s||{},o=`/rest/data/v2.0/xobjects/${t}/busiType`;try{const t={...a,url:o,method:"GET"},s=await e(t);if(200===s.code||"200"===s.code){const{records:t,totalSize:e}=s.data||{};return{status:!0,code:s.code,msg:s.msg||"获取业务类型列表成功",totalSize:e,data:t||[]}}return{status:!1,code:s.code,msg:s.msg||"获取业务类型列表失败",data:[]}}catch(t){return console.error("获取业务类型列表失败:",t),{status:!1,msg:t.msg||t.message||"获取业务类型列表失败",data:[]}}},getEntityList:async t=>{const s=t||{},a=s.active??!0,o=s.custom;let c=`/rest/metadata/v2.0/xobjects/filter?active=${a}`;void 0!==o&&(c=`/rest/metadata/v2.0/xobjects/filter?custom=${o}&active=${a}`);try{const t={...s,url:c,method:"GET"},a=await e(t);if("0"===a.code||0===a.code||"200"===a.code||200===a.code){const{records:t,totalSize:e}=a.data||{};return{status:!0,code:a.code,msg:a.msg||"获取对象列表成功",totalSize:e,data:t||[]}}return{status:!1,code:a.code,msg:a.msg||"获取对象列表失败",data:[]}}catch(t){return console.error("获取对象列表失败:",t),{status:!1,msg:t.msg||t.message||"获取对象列表失败",data:[]}}},getDesc:async(t,s)=>{const a=s||{},o=`/rest/data/v2.0/xobjects/${t}/description`;try{const t={...s,url:o,method:a.method||"GET"},c=await e(t);return"200"===c.code||200===c.code?{status:!0,code:c.code,msg:c.msg||"获取业务对象描述数据成功",data:c.data||{}}:{status:!1,code:c.code,msg:c.msg||"获取业务对象描述数据失败",data:{}}}catch(t){return console.error("获取业务对象描述数据失败:",t),{status:!1,msg:t.msg||t.message||"获取业务对象描述数据失败",data:{}}}},create:async(t,s)=>{const a=s||{},o=`/rest/data/v2.0/xobjects/${t}`,c=a.data||{};try{const t={...s,url:o,method:a.method||"POST",data:{data:c}},r=await e(t);return"200"===r.code||200===r.code?{status:!0,code:r.code,msg:r.msg||"创建业务数据成功",data:r.data||{}}:{status:!1,code:r.code,msg:r.msg||"创建业务数据失败",data:{}}}catch(t){return console.error("创建业务数据失败:",t),{status:!1,msg:t.msg||t.message||"创建业务数据失败",data:{}}}},update:async(t,s,a)=>{const o=a||{},c=`/rest/data/v2.0/xobjects/${t}/${s}`,r=o.data||{};try{const t={...o,url:c,method:o.method||"PATCH",data:{data:r}},s=await e(t);return"200"===s.code||200===s.code?{status:!0,code:s.code,msg:s.msg||"更新业务数据成功",data:s.data||{}}:{status:!1,code:s.code,msg:s.msg||"更新业务数据失败",data:{}}}catch(t){return console.error("更新业务数据失败:",t),{status:!1,msg:t.msg||t.message||"更新业务数据失败",data:{}}}},get:async(t,s,a)=>{let o=t,c=s,r=a||{};"object"==typeof t&&t.xObjectApiKey&&(r=t.options||{},c=t.objectId,o=t.xObjectApiKey);const d=`/rest/data/v2.0/xobjects/${o}/${c}`;try{const t={...r,url:d,method:r.method||"GET"},s=await e(t);return"200"===s.code||200===s.code?{status:!0,code:s.code,msg:s.msg||"获取业务数据成功",data:s.data||{}}:{status:!1,code:s.code,msg:s.msg||"获取业务数据失败",data:{}}}catch(t){return console.error("获取业务数据失败:",t),{status:!1,msg:t.msg||t.message||"获取业务数据失败",data:{}}}},delete:async(t,s,a)=>{const o=a||{},c=`/rest/data/v2.0/xobjects/${t}/${s}`;try{const t={...o,url:c,method:o.method||"DELETE"},s=await e(t);return"200"===s.code||200===s.code?{status:!0,code:s.code,msg:s.msg||"删除业务数据成功"}:{status:!1,code:s.code,msg:s.msg||"删除业务数据失败"}}catch(t){return console.error("删除业务数据失败:",t),{status:!1,msg:t.msg||t.message||"删除业务数据失败"}}}},a={getList:async t=>{const s=t||{},a=`/rest/metadata/v2.0/dx/logic/extpoints/openapi?pageNo=${s.pageNo||1}&pageSize=${s.pageSize||1e3}`;try{const t={url:a,method:"GET"},s=await e(t);if("0"===s.code||0===s.code||"200"===s.code||200===s.code){const{items:t,count:e}=s.data||{};return{status:!0,code:s.code,msg:s.msg||"获取自定义API列表成功",totalSize:e,data:t||[]}}return{status:!1,code:s.code,msg:s.msg||"获取自定义API列表失败",data:[]}}catch(t){return console.error("获取自定义API列表失败:",t),{status:!1,msg:t.msg||t.message||"获取自定义API列表失败",data:[]}}},run:async t=>{const s=t||{},a=s.apiUrl||"",o=s.methodType||s.method||"POST",c=s.data||{};try{const s={...t,url:a,method:o,data:c};return{status:!0,...await e(s)}}catch(t){return console.error("执行自定义API失败:",t),{status:!1,msg:t.msg||t.message||"执行自定义API失败",data:{}}}}};export{e as axiosFetcher,a as customApi,s as xObject};
